{% load static %}
<script>
  $('#myselect-{{ day.date.isoformat }}').selectize({
    persist: false,
    delimiter: ';',
    create: true,
    createOnBlur: true,
    openOnFocus: false,
    onItemAdd: function() {
      // Close dropdown when choosing a meal
      this.close();
    }
  });

  // The selectize element and the buttons are hidden when the page is loaded so that they are not visible for a brief
  // second before the javascript is executed. After selectized has done its work, show these elements again.
  $('.hidden').removeAttr('hidden');
</script>
<form id="update-day-{{ day.date.isoformat }}" method="post">
  {% csrf_token %}
  <select name="select" id="myselect-{{ day.date.isoformat }}" class="hidden" multiple="multiple" hidden>
    {% for meal_name in todays_meal_names %}
    <option value="{{ meal_name }}" selected="selected">{{ meal_name }}</option>
    {% endfor %}
    {% for meal_name in database_meal_names %}
    <option value="{{ meal_name }}">{{ meal_name }}</option>
    {% endfor %}
  </select>
  <button type="button" class="btn btn-secondary hidden cancel-edit-day" hx-target="td.day-{{ day.date.isoformat }}"
          hx-get="{% url 'planner:show_day' date=day.date %}" hidden>Cancel</button>
  <button type="submit" form="update-day-{{ day.date.isoformat }}"
          class="btn btn-primary hidden" hx-post="{% url 'planner:edit_day' date=day.date.isoformat %}"
          hx-target="td.day-{{ day.date.isoformat }}" hidden>Save changes</button>
</form>
